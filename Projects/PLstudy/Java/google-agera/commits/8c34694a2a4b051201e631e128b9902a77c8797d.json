{"sha":"8c34694a2a4b051201e631e128b9902a77c8797d","commit":{"author":{"name":"Kushal Sharma","email":"kushal.sharma@flipkart.com","date":"2017-03-04T20:33:51Z"},"committer":{"name":"Magnus Ernstsson","email":"magnus@ernstsson.net","date":"2017-03-04T20:33:51Z"},"message":"Resource leak fix in test app (#143)\n\n* Added close request in database extention and test app\r\n\r\n* Clean up\r\n\r\n* Use database supplier to close database","tree":{"sha":"cf82e9b73fb03f8abdd6cda32a87ad5b4bc5b1ac","url":"https://api.github.com/repos/google/agera/git/trees/cf82e9b73fb03f8abdd6cda32a87ad5b4bc5b1ac"},"url":"https://api.github.com/repos/google/agera/git/commits/8c34694a2a4b051201e631e128b9902a77c8797d","comment_count":0},"url":"https://api.github.com/repos/google/agera/commits/8c34694a2a4b051201e631e128b9902a77c8797d","html_url":"https://github.com/google/agera/commit/8c34694a2a4b051201e631e128b9902a77c8797d","comments_url":"https://api.github.com/repos/google/agera/commits/8c34694a2a4b051201e631e128b9902a77c8797d/comments","author":{"login":"kushalsharma","id":16554194,"avatar_url":"https://avatars2.githubusercontent.com/u/16554194?v=3","gravatar_id":"","url":"https://api.github.com/users/kushalsharma","html_url":"https://github.com/kushalsharma","followers_url":"https://api.github.com/users/kushalsharma/followers","following_url":"https://api.github.com/users/kushalsharma/following{/other_user}","gists_url":"https://api.github.com/users/kushalsharma/gists{/gist_id}","starred_url":"https://api.github.com/users/kushalsharma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kushalsharma/subscriptions","organizations_url":"https://api.github.com/users/kushalsharma/orgs","repos_url":"https://api.github.com/users/kushalsharma/repos","events_url":"https://api.github.com/users/kushalsharma/events{/privacy}","received_events_url":"https://api.github.com/users/kushalsharma/received_events","type":"User","site_admin":false},"committer":{"login":"ernstsson","id":378389,"avatar_url":"https://avatars2.githubusercontent.com/u/378389?v=3","gravatar_id":"","url":"https://api.github.com/users/ernstsson","html_url":"https://github.com/ernstsson","followers_url":"https://api.github.com/users/ernstsson/followers","following_url":"https://api.github.com/users/ernstsson/following{/other_user}","gists_url":"https://api.github.com/users/ernstsson/gists{/gist_id}","starred_url":"https://api.github.com/users/ernstsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ernstsson/subscriptions","organizations_url":"https://api.github.com/users/ernstsson/orgs","repos_url":"https://api.github.com/users/ernstsson/repos","events_url":"https://api.github.com/users/ernstsson/events{/privacy}","received_events_url":"https://api.github.com/users/ernstsson/received_events","type":"User","site_admin":false},"parents":[{"sha":"0600d79daf49c3db8de9570dc36874c39ca8f5d6","url":"https://api.github.com/repos/google/agera/commits/0600d79daf49c3db8de9570dc36874c39ca8f5d6","html_url":"https://github.com/google/agera/commit/0600d79daf49c3db8de9570dc36874c39ca8f5d6"}],"stats":{"total":14,"additions":12,"deletions":2},"files":[{"sha":"1e3f50412e58a9aad92ccdf38593f7d7f397528a","filename":"testapp/src/main/java/com/google/android/agera/testapp/NotesFragment.java","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/google/agera/blob/8c34694a2a4b051201e631e128b9902a77c8797d/testapp/src/main/java/com/google/android/agera/testapp/NotesFragment.java","raw_url":"https://github.com/google/agera/raw/8c34694a2a4b051201e631e128b9902a77c8797d/testapp/src/main/java/com/google/android/agera/testapp/NotesFragment.java","contents_url":"https://api.github.com/repos/google/agera/contents/testapp/src/main/java/com/google/android/agera/testapp/NotesFragment.java?ref=8c34694a2a4b051201e631e128b9902a77c8797d","patch":"@@ -173,5 +173,6 @@ public void onDestroyView() {\n     recyclerView.setAdapter(null);\n     recyclerView = null;\n     pool.clear();\n+    notesStore.closeDatabase();\n   }\n }"},{"sha":"d478c1df7c33ed1dcd6a9e176b48bb984f70211e","filename":"testapp/src/main/java/com/google/android/agera/testapp/NotesStore.java","status":"modified","additions":11,"deletions":2,"changes":13,"blob_url":"https://github.com/google/agera/blob/8c34694a2a4b051201e631e128b9902a77c8797d/testapp/src/main/java/com/google/android/agera/testapp/NotesStore.java","raw_url":"https://github.com/google/agera/raw/8c34694a2a4b051201e631e128b9902a77c8797d/testapp/src/main/java/com/google/android/agera/testapp/NotesStore.java","contents_url":"https://api.github.com/repos/google/agera/contents/testapp/src/main/java/com/google/android/agera/testapp/NotesStore.java?ref=8c34694a2a4b051201e631e128b9902a77c8797d","patch":"@@ -45,6 +45,7 @@\n import com.google.android.agera.Repository;\n import com.google.android.agera.Result;\n import com.google.android.agera.UpdateDispatcher;\n+import com.google.android.agera.database.SqlDatabaseSupplier;\n import com.google.android.agera.database.SqlDeleteRequest;\n import com.google.android.agera.database.SqlInsertRequest;\n import com.google.android.agera.database.SqlUpdateRequest;\n@@ -78,15 +79,19 @@\n   private final Receiver<SqlUpdateRequest> update;\n   @NonNull\n   private final Receiver<SqlDeleteRequest> delete;\n+  @NonNull\n+  private final SqlDatabaseSupplier databaseSupplier;\n \n   private NotesStore(@NonNull final Repository<List<NoteGroup>> notesRepository,\n       @NonNull final Receiver<SqlInsertRequest> insert,\n       @NonNull final Receiver<SqlUpdateRequest> update,\n-      @NonNull final Receiver<SqlDeleteRequest> delete) {\n+      @NonNull final Receiver<SqlDeleteRequest> delete,\n+      @NonNull final SqlDatabaseSupplier databaseSupplier) {\n     this.insert = insert;\n     this.update = update;\n     this.delete = delete;\n     this.notesRepository = notesRepository;\n+    this.databaseSupplier = databaseSupplier;\n   }\n \n   @NonNull\n@@ -149,7 +154,7 @@ synchronized static NotesStore notesStore(@NonNull final Context applicationCont\n         })\n         .onConcurrentUpdate(SEND_INTERRUPT)\n         .onDeactivation(SEND_INTERRUPT)\n-        .compile(), insert, update, delete);\n+        .compile(), insert, update, delete, databaseSupplier);\n   }\n \n   @NonNull\n@@ -186,4 +191,8 @@ void clearNotes() {\n         .table(NOTES_TABLE)\n         .compile());\n   }\n+\n+  void closeDatabase() {\n+    databaseSupplier.close();\n+  }\n }"}]}