{"sha":"8b2798c7a17515b611977a2d5946a3e69889c51f","commit":{"author":{"name":"Magnus Ernstsson","email":"magnus@ernstsson.net","date":"2016-04-30T19:11:13Z"},"committer":{"name":"Magnus Ernstsson","email":"magnus@ernstsson.net","date":"2016-04-30T22:49:27Z"},"message":"Added a function that wrap a Throwable in a Result\n\nWhen ending an attemptXYZ operation with .orSkip the failure is not\nstored in the repository (as is the intention). To route the failure\nback into a repository of Result .orEnd needs to be used, and the\nThrowable needs to be wrapped in a Result. This function does exactly\nthat.","tree":{"sha":"fcb615409bb490b40b54f37bb9d2a4db9f711559","url":"https://api.github.com/repos/google/agera/git/trees/fcb615409bb490b40b54f37bb9d2a4db9f711559"},"url":"https://api.github.com/repos/google/agera/git/commits/8b2798c7a17515b611977a2d5946a3e69889c51f","comment_count":0},"url":"https://api.github.com/repos/google/agera/commits/8b2798c7a17515b611977a2d5946a3e69889c51f","html_url":"https://github.com/google/agera/commit/8b2798c7a17515b611977a2d5946a3e69889c51f","comments_url":"https://api.github.com/repos/google/agera/commits/8b2798c7a17515b611977a2d5946a3e69889c51f/comments","author":{"login":"ernstsson","id":378389,"avatar_url":"https://avatars2.githubusercontent.com/u/378389?v=3","gravatar_id":"","url":"https://api.github.com/users/ernstsson","html_url":"https://github.com/ernstsson","followers_url":"https://api.github.com/users/ernstsson/followers","following_url":"https://api.github.com/users/ernstsson/following{/other_user}","gists_url":"https://api.github.com/users/ernstsson/gists{/gist_id}","starred_url":"https://api.github.com/users/ernstsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ernstsson/subscriptions","organizations_url":"https://api.github.com/users/ernstsson/orgs","repos_url":"https://api.github.com/users/ernstsson/repos","events_url":"https://api.github.com/users/ernstsson/events{/privacy}","received_events_url":"https://api.github.com/users/ernstsson/received_events","type":"User","site_admin":false},"committer":{"login":"ernstsson","id":378389,"avatar_url":"https://avatars2.githubusercontent.com/u/378389?v=3","gravatar_id":"","url":"https://api.github.com/users/ernstsson","html_url":"https://github.com/ernstsson","followers_url":"https://api.github.com/users/ernstsson/followers","following_url":"https://api.github.com/users/ernstsson/following{/other_user}","gists_url":"https://api.github.com/users/ernstsson/gists{/gist_id}","starred_url":"https://api.github.com/users/ernstsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ernstsson/subscriptions","organizations_url":"https://api.github.com/users/ernstsson/orgs","repos_url":"https://api.github.com/users/ernstsson/repos","events_url":"https://api.github.com/users/ernstsson/events{/privacy}","received_events_url":"https://api.github.com/users/ernstsson/received_events","type":"User","site_admin":false},"parents":[{"sha":"af3729ae891ab1775b64bbc31181a9c3a760d5ca","url":"https://api.github.com/repos/google/agera/commits/af3729ae891ab1775b64bbc31181a9c3a760d5ca","html_url":"https://github.com/google/agera/commit/af3729ae891ab1775b64bbc31181a9c3a760d5ca"}],"stats":{"total":29,"additions":29,"deletions":0},"files":[{"sha":"8bad1a8b2662fd77317ba1c6ff4da6bdb547d975","filename":"agera/src/main/java/com/google/android/agera/Common.java","status":"modified","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/google/agera/blob/8b2798c7a17515b611977a2d5946a3e69889c51f/agera/src/main/java/com/google/android/agera/Common.java","raw_url":"https://github.com/google/agera/raw/8b2798c7a17515b611977a2d5946a3e69889c51f/agera/src/main/java/com/google/android/agera/Common.java","contents_url":"https://api.github.com/repos/google/agera/contents/agera/src/main/java/com/google/android/agera/Common.java?ref=8b2798c7a17515b611977a2d5946a3e69889c51f","patch":"@@ -16,6 +16,7 @@\n package com.google.android.agera;\n \n import static com.google.android.agera.Preconditions.checkNotNull;\n+import static com.google.android.agera.Result.failure;\n \n import com.google.android.agera.BaseObservable.Worker;\n import com.google.android.agera.Observables.LowPassFilterObservable;\n@@ -27,6 +28,7 @@\n import java.lang.ref.WeakReference;\n \n final class Common {\n+  static final Function<Throwable, ? extends Result<?>> FAILED_RESULT = new FailedResult<>();\n   static final Function IDENTITY_FUNCTION = new IdentityFunction();\n   static final StaticCondicate TRUE_CONDICATE = new StaticCondicate(true);\n   static final StaticCondicate FALSE_CONDICATE = new StaticCondicate(false);\n@@ -139,5 +141,13 @@ public void handleMessage(final Message message) {\n     }\n   }\n \n+  private static final class FailedResult<T> implements Function<Throwable, Result<T>> {\n+    @NonNull\n+    @Override\n+    public Result<T> apply(@NonNull final Throwable input) {\n+      return failure(input);\n+    }\n+  }\n+\n   private Common() {}\n }"},{"sha":"8be9b14e22ce76e672c15ca85a6261bcb10f3f2f","filename":"agera/src/main/java/com/google/android/agera/Functions.java","status":"modified","additions":11,"deletions":0,"changes":11,"blob_url":"https://github.com/google/agera/blob/8b2798c7a17515b611977a2d5946a3e69889c51f/agera/src/main/java/com/google/android/agera/Functions.java","raw_url":"https://github.com/google/agera/raw/8b2798c7a17515b611977a2d5946a3e69889c51f/agera/src/main/java/com/google/android/agera/Functions.java","contents_url":"https://api.github.com/repos/google/agera/contents/agera/src/main/java/com/google/android/agera/Functions.java?ref=8b2798c7a17515b611977a2d5946a3e69889c51f","patch":"@@ -15,6 +15,7 @@\n  */\n package com.google.android.agera;\n \n+import static com.google.android.agera.Common.FAILED_RESULT;\n import static com.google.android.agera.Common.IDENTITY_FUNCTION;\n import static com.google.android.agera.Preconditions.checkNotNull;\n \n@@ -84,6 +85,16 @@\n     return new FunctionCompiler();\n   }\n \n+  /**\n+   * Returns a {@link Function} that wraps a {@link Throwable} in a\n+   * {@link Result#failure(Throwable)}).\n+   */\n+  @SuppressWarnings(\"unchecked\")\n+  @NonNull\n+  public static <T> Function<Throwable, Result<T>> failedResult() {\n+    return (Function<Throwable, Result<T>>) FAILED_RESULT;\n+  }\n+\n   private static final class SupplierAsFunction<F, T> implements Function<F, T> {\n     @NonNull\n     private final Supplier<? extends T> supplier;"},{"sha":"d77b77ebc73ea4fdcd92ff8bf3de34e950899750","filename":"agera/src/test/java/com/google/android/agera/FunctionsTest.java","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/google/agera/blob/8b2798c7a17515b611977a2d5946a3e69889c51f/agera/src/test/java/com/google/android/agera/FunctionsTest.java","raw_url":"https://github.com/google/agera/raw/8b2798c7a17515b611977a2d5946a3e69889c51f/agera/src/test/java/com/google/android/agera/FunctionsTest.java","contents_url":"https://api.github.com/repos/google/agera/contents/agera/src/test/java/com/google/android/agera/FunctionsTest.java?ref=8b2798c7a17515b611977a2d5946a3e69889c51f","patch":"@@ -15,6 +15,7 @@\n  */\n package com.google.android.agera;\n \n+import static com.google.android.agera.Functions.failedResult;\n import static com.google.android.agera.Functions.functionFrom;\n import static com.google.android.agera.Functions.functionFromListOf;\n import static com.google.android.agera.Functions.identityFunction;\n@@ -82,6 +83,13 @@ public void setup() {\n   }\n \n   @Test\n+  public void shouldWrapThrowableInFailedResult() {\n+    final Throwable throwable = new Throwable();\n+\n+    assertThat(failedResult().apply(throwable).getFailure(), is(throwable));\n+  }\n+\n+  @Test\n   public void shouldReturnObjectFromStaticFunction() {\n     assertThat(staticFunction(INPUT_STRING).apply(new Object()), is(sameInstance(INPUT_STRING)));\n   }"}]}