{"sha":"bde24d67de273bad85488f12a6802952f7fc7b0b","commit":{"author":{"name":"Magnus Ernstsson","email":"magnus@ernstsson.net","date":"2016-05-31T15:46:34Z"},"committer":{"name":"Magnus Ernstsson","email":"magnus@ernstsson.net","date":"2016-05-31T15:46:34Z"},"message":"Changed observable activated to be called immediately (#58)\n\nWhen adding an updatable observableActivated is now called immediately\r\nif the updatable is added from the same looper as the observable is\r\noperating on","tree":{"sha":"bb58f04debab8180e213148cf17c11677cf7cb30","url":"https://api.github.com/repos/google/agera/git/trees/bb58f04debab8180e213148cf17c11677cf7cb30"},"url":"https://api.github.com/repos/google/agera/git/commits/bde24d67de273bad85488f12a6802952f7fc7b0b","comment_count":0},"url":"https://api.github.com/repos/google/agera/commits/bde24d67de273bad85488f12a6802952f7fc7b0b","html_url":"https://github.com/google/agera/commit/bde24d67de273bad85488f12a6802952f7fc7b0b","comments_url":"https://api.github.com/repos/google/agera/commits/bde24d67de273bad85488f12a6802952f7fc7b0b/comments","author":{"login":"ernstsson","id":378389,"avatar_url":"https://avatars2.githubusercontent.com/u/378389?v=3","gravatar_id":"","url":"https://api.github.com/users/ernstsson","html_url":"https://github.com/ernstsson","followers_url":"https://api.github.com/users/ernstsson/followers","following_url":"https://api.github.com/users/ernstsson/following{/other_user}","gists_url":"https://api.github.com/users/ernstsson/gists{/gist_id}","starred_url":"https://api.github.com/users/ernstsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ernstsson/subscriptions","organizations_url":"https://api.github.com/users/ernstsson/orgs","repos_url":"https://api.github.com/users/ernstsson/repos","events_url":"https://api.github.com/users/ernstsson/events{/privacy}","received_events_url":"https://api.github.com/users/ernstsson/received_events","type":"User","site_admin":false},"committer":{"login":"ernstsson","id":378389,"avatar_url":"https://avatars2.githubusercontent.com/u/378389?v=3","gravatar_id":"","url":"https://api.github.com/users/ernstsson","html_url":"https://github.com/ernstsson","followers_url":"https://api.github.com/users/ernstsson/followers","following_url":"https://api.github.com/users/ernstsson/following{/other_user}","gists_url":"https://api.github.com/users/ernstsson/gists{/gist_id}","starred_url":"https://api.github.com/users/ernstsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ernstsson/subscriptions","organizations_url":"https://api.github.com/users/ernstsson/orgs","repos_url":"https://api.github.com/users/ernstsson/repos","events_url":"https://api.github.com/users/ernstsson/events{/privacy}","received_events_url":"https://api.github.com/users/ernstsson/received_events","type":"User","site_admin":false},"parents":[{"sha":"8eb666c8e946bbb3c90b1f6ed539e69ba9d76924","url":"https://api.github.com/repos/google/agera/commits/8eb666c8e946bbb3c90b1f6ed539e69ba9d76924","html_url":"https://github.com/google/agera/commit/8eb666c8e946bbb3c90b1f6ed539e69ba9d76924"}],"stats":{"total":11,"additions":9,"deletions":2},"files":[{"sha":"34e8291d424cf0a01e78fca5d5aa5edebe74d743","filename":"agera/src/main/java/com/google/android/agera/BaseObservable.java","status":"modified","additions":7,"deletions":1,"changes":8,"blob_url":"https://github.com/google/agera/blob/bde24d67de273bad85488f12a6802952f7fc7b0b/agera/src/main/java/com/google/android/agera/BaseObservable.java","raw_url":"https://github.com/google/agera/raw/bde24d67de273bad85488f12a6802952f7fc7b0b/agera/src/main/java/com/google/android/agera/BaseObservable.java","contents_url":"https://api.github.com/repos/google/agera/contents/agera/src/main/java/com/google/android/agera/BaseObservable.java?ref=bde24d67de273bad85488f12a6802952f7fc7b0b","patch":"@@ -68,16 +68,22 @@ protected BaseObservable() {\n   public final void addUpdatable(@NonNull final Updatable updatable) {\n     checkState(Looper.myLooper() != null, \"Can only be added on a Looper thread\");\n     checkNotNull(updatable);\n+    boolean activateNow = false;\n     synchronized (token) {\n       add(updatable, workerHandler());\n       if (size == 1) {\n         if (handler.hasMessages(MSG_LAST_REMOVED, this)) {\n           handler.removeMessages(MSG_LAST_REMOVED, this);\n+        } else if (Looper.myLooper() == handler.getLooper()) {\n+          activateNow = true;\n         } else {\n           handler.obtainMessage(WorkerHandler.MSG_FIRST_ADDED, this).sendToTarget();\n         }\n       }\n     }\n+    if (activateNow) {\n+      observableActivated();\n+    }\n   }\n \n   @Override\n@@ -148,7 +154,7 @@ void sendUpdate() {\n       if (shortestUpdateWindowMillis > 0) {\n         final long elapsedRealtimeMillis = elapsedRealtime();\n         final long timeFromLastUpdate = elapsedRealtimeMillis - lastUpdateTimestamp;\n-        if (timeFromLastUpdate  < shortestUpdateWindowMillis) {\n+        if (timeFromLastUpdate < shortestUpdateWindowMillis) {\n           handler.sendMessageDelayed(handler.obtainMessage(WorkerHandler.MSG_UPDATE, this),\n               shortestUpdateWindowMillis - timeFromLastUpdate);\n           return;"},{"sha":"3e9719fa92467586b17ae31fcc52bc7e7b1a45ca","filename":"agera/src/test/java/com/google/android/agera/RepositoriesTest.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/google/agera/blob/bde24d67de273bad85488f12a6802952f7fc7b0b/agera/src/test/java/com/google/android/agera/RepositoriesTest.java","raw_url":"https://github.com/google/agera/raw/bde24d67de273bad85488f12a6802952f7fc7b0b/agera/src/test/java/com/google/android/agera/RepositoriesTest.java","contents_url":"https://api.github.com/repos/google/agera/contents/agera/src/test/java/com/google/android/agera/RepositoriesTest.java?ref=bde24d67de273bad85488f12a6802952f7fc7b0b","patch":"@@ -29,6 +29,7 @@\n import static java.util.Arrays.asList;\n import static java.util.Collections.singletonList;\n import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.mockito.Mockito.atLeastOnce;\n import static org.mockito.Mockito.times;\n import static org.mockito.Mockito.verify;\n import static org.mockito.Mockito.verifyZeroInteractions;\n@@ -336,7 +337,7 @@ public void shouldCompileIntoNextRepository() throws Exception {\n \n     updatable.addToObservable(repository);\n \n-    verify(mockIntegerListToIntValueFunction).apply(LIST);\n+    verify(mockIntegerListToIntValueFunction, atLeastOnce()).apply(LIST);\n     assertThat(repository, has(INT_VALUE));\n   }\n "}]}